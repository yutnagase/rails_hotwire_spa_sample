<%= turbo_stream.update "flash_messages" do %>
  <div class="mb-4 bg-green-50 border border-green-200 rounded-md p-4">
    <div class="flex">
      <div class="ml-3">
        <p class="text-sm font-medium text-green-800">売上が正常に作成されました。</p>
      </div>
    </div>
  </div>
<% end %>

<%= turbo_stream.update "sales_list" do %>
  <table class="min-w-full divide-y divide-gray-300">
    <thead class="bg-gray-50">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">日付</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">従業員</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">商品</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">取引先</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">数量</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">金額</th>
        <th scope="col" class="relative px-6 py-3"><span class="sr-only">操作</span></th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <% Sale.includes(:employee, :product, :customer).order(date: :desc).each do |sale| %>
        <tr id="sale_<%= sale.id %>">
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= sale.date.strftime("%Y/%m/%d") %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= sale.employee.name %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= sale.product.name %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= sale.customer.name %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><%= sale.quantity %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">¥<%= number_with_delimiter(sale.amount) %></td>
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
            <%= link_to "表示", sale, class: "text-blue-600 hover:text-blue-900 mr-3", data: { turbo_frame: "_top" } %>
            <%= link_to "編集", edit_sale_path(sale), 
                class: "text-blue-600 hover:text-blue-900 mr-3",
                data: { turbo_frame: "sale_form" } %>
            <%= link_to "削除", sale, method: :delete,
                class: "text-red-600 hover:text-red-900",
                confirm: "本当に削除しますか？",
                data: { turbo_method: :delete } %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>

<%= turbo_stream.update "sale_form", "" %>