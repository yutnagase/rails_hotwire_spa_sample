<%= turbo_stream.update "flash_messages" do %>
  <div class="mb-4 bg-green-50 border border-green-200 rounded-md p-4">
    <div class="flex">
      <div class="ml-3">
        <p class="text-sm font-medium text-green-800">商品が正常に作成されました。</p>
      </div>
    </div>
  </div>
<% end %>

<%= turbo_stream.update "products_list" do %>
  <table class="min-w-full divide-y divide-gray-300">
    <thead class="bg-gray-50">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">商品コード</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">商品名</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">原価</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">売価</th>
        <th scope="col" class="relative px-6 py-3"><span class="sr-only">操作</span></th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <% Product.all.each do |product| %>
        <tr id="product_<%= product.id %>">
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><%= product.code %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= product.name %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">¥<%= number_with_delimiter(product.cost_price) %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">¥<%= number_with_delimiter(product.selling_price) %></td>
          <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
            <%= link_to "表示", product, class: "text-green-600 hover:text-green-900 mr-3", data: { turbo_frame: "_top" } %>
            <%= link_to "編集", edit_product_path(product), 
                class: "text-green-600 hover:text-green-900 mr-3",
                data: { turbo_frame: "product_form" } %>
            <%= link_to "削除", product, method: :delete,
                class: "text-red-600 hover:text-red-900",
                confirm: "本当に削除しますか？",
                data: { turbo_method: :delete } %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>

<%= turbo_stream.update "product_form", "" %>